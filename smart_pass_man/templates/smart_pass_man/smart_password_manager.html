{% extends 'base.html' %}
{% load static %}
{% load smart_pass_man_filters %}


{% block title %}Smart Password Manager{% endblock %}

{% block css %}
<style>
.table-custom {
    --bs-table-bg: #1a1a1a;
    --bs-table-color: #e0e0e0;
    --bs-table-border-color: #444;
}

.table-custom thead {
    background-color: #2a2a2a;
}

.table-custom th {
    color: #ffffff;
    border-bottom: 2px solid #555;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
}

.table-custom tbody tr {
    transition: all 0.2s ease;
}

.table-custom tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.table-custom td {
    vertical-align: middle;
    border-top: 1px solid #333;
}

.table-custom .btn-group .btn {
    opacity: 0.8;
    transition: all 0.2s ease;
}

.table-custom .btn-group .btn:hover {
    opacity: 1;
    transform: scale(1.05);
}

.table-custom {
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
}

.table-custom thead {
    backdrop-filter: blur(5px);
    background-color: rgba(42, 42, 42, 0.8);
}

.table-custom tbody tr:nth-child(odd) {
    background-color: rgba(30, 30, 30, 0.5);
}

.table-custom tbody tr:nth-child(even) {
    background-color: rgba(26, 26, 26, 0.5);
}
</style>
{% endblock %}

{% block content %}

    {% if password %}
        <div id="passBlock" class="rounded"  style="box-shadow: 0 0 5px yellow; padding: 15px;">
            <h3 class="display-6 text-center text-warning"><i class="bi bi-unlock-fill"></i> Generated smart password:</h3>
            <form>
                <div class="input-group">
                    <label for="generated-password"></label><input class="form-control" type="text"
                                                                   value="{{ password }}" id="generated-password"
                                                                   readonly>
                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">Copy</button>
                </div>
            </form>
        </div>
        <hr>
    {% endif %}
    <h1 class="display-6 text-primary text-center"><i class="bi bi-lock-fill"></i> Smart Password Manager</h1>
    <hr>
    <div class="btn-group btn-group-sm">
        <a class="btn btn-success" href="{% url "smart_password_manager:smart_password_create" %}">+ Add</a>
    </div>
    <hr>

    {% if has_passwords %}
        <div class="table-responsive">
        <table id="SmartPasswords" class="table table-bordered table-hover table-custom">
            <thead>
            <tr>
                <th scope="col">Login</th>
                <th scope="col">Length</th>
                <th scope="col">Public Key</th>
                <th scope="col">Created</th>
                <th scope="col">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for password in page_obj %}
                <tr>
                    <td>{{ password.login }}</td>
                    <td>{{ password.length }}</td>
                    <td>{{ password.public_key|obfuscate_public_key }}</td>
                    <td>{{ password.created_at|date:"d.m.Y H:i:s" }}</td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                            <a href="{% url "smart_password_manager:smart_password_generate" password.pk %}"
                               type="button" class="btn btn-secondary" data-bs-toggle="tooltip" data-bs-placement="top"
                               title="Generate Smart Password"><i class="bi bi-unlock-fill"></i></a>
                            <a onclick="return confirm('Are you sure?')"
                               href="{% url "smart_password_manager:smart_password_delete" password.pk %}"
                               type="button" class="btn btn-danger" data-bs-toggle="tooltip" data-bs-placement="top"
                               title="Delete Smart Password"><i class="bi bi-trash-fill"></i></a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
        {% if page_obj.has_other_pages %} {% include "paginator.html" %} {% endif %}
    {% else %}
        <div class="alert alert-primary" role="alert">
            Smart Passwords not found...
        </div>
    {% endif %}

{% endblock %}

{% block js %}
    <script>

        async function copyToClipboard() {
    const copyText = document.getElementById("generated-password").value;
    const button = event.currentTarget;
    const passwordBlock = $('#passBlock');

    try {
        await navigator.clipboard.writeText(copyText);
        button.textContent = 'âœ“';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');

        setTimeout(() => {
            passwordBlock.remove();
        }, 2000);

    } catch (err) {
        console.error("Failed to copy password:", err);
    }
}
    </script>
{% endblock %}
